{"paragraphs":[{"text":"spark","user":"anonymous","dateUpdated":"2019-05-25T12:12:50-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550446593081_-787201137","id":"20190217-153633_1001806453","dateCreated":"2019-02-17T15:36:33-0800","dateStarted":"2019-05-25T12:12:50-0700","dateFinished":"2019-05-25T12:13:09-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:11534"},{"text":"/* Load up the Wine Reviews Dataset (via kaggle) */\nval dataLocation = \"/user/ds/odsc/\"\nval wineReviewsDf = spark.read.option(\"inferSchema\", true).json(s\"$dataLocation/winereviews.json\")\nwineReviewsDf.cache()","user":"anonymous","dateUpdated":"2019-05-25T12:21:57-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550447023171_658513409","id":"20190217-154343_1399667423","dateCreated":"2019-02-17T15:43:43-0800","dateStarted":"2019-05-25T12:21:57-0700","dateFinished":"2019-05-25T12:22:00-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11535"},{"text":"wineReviewsDf.schema","user":"anonymous","dateUpdated":"2019-05-25T12:13:20-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550515236358_370990528","id":"20190218-104036_1836308631","dateCreated":"2019-02-18T10:40:36-0800","dateStarted":"2019-05-25T12:13:20-0700","dateFinished":"2019-05-25T12:13:20-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11536"},{"text":"wineReviewsDf.printSchema","user":"anonymous","dateUpdated":"2019-05-25T12:13:20-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550447824149_1211771260","id":"20190217-155704_1050760426","dateCreated":"2019-02-17T15:57:04-0800","dateStarted":"2019-05-25T12:13:21-0700","dateFinished":"2019-05-25T12:13:21-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11537"},{"text":"wineReviewsDf.createOrReplaceTempView(\"reviews\")","user":"anonymous","dateUpdated":"2019-05-25T12:13:21-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550514447444_2038986330","id":"20190218-102727_605231430","dateCreated":"2019-02-18T10:27:27-0800","dateStarted":"2019-05-25T12:13:21-0700","dateFinished":"2019-05-25T12:13:22-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11538"},{"text":"%sql\nselect winery, avg(points) as avg_rating from reviews where country = 'France' AND region_1 = 'Côtes de Provence' AND points > 88 group by winery order by avg_rating desc","user":"anonymous","dateUpdated":"2019-05-25T12:13:22-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{"columns":[{"name":"country","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"description","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"designation","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"points","visible":true,"width":"*","sort":{"priority":0,"direction":"desc"},"filters":[{}],"pinned":""},{"name":"price","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"province","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"region_1","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"region_2","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"taster_name","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"taster_twitter_handle","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"title","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"variety","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"winery","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""}],"scrollFocus":{},"selection":[],"grouping":{"grouping":[],"aggregations":[],"rowExpandedStates":{}},"treeView":{},"pagination":{"paginationCurrentPage":1,"paginationPageSize":250}},"tableColumnTypeState":{"names":{"winery":"string","avg_rating":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"stackedAreaChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"commonSetting":{},"keys":[{"name":"winery","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"avg_rating","index":1,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550722185129_-1758864926","id":"20190220-200945_2010532697","dateCreated":"2019-02-20T20:09:45-0800","dateStarted":"2019-05-25T12:13:22-0700","dateFinished":"2019-05-25T12:13:27-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11539"},{"text":"%sql\nselect country, designation, points, price, variety, winery from reviews\nwhere designation IS NOT NULL\norder by price desc","user":"anonymous","dateUpdated":"2019-05-25T12:13:27-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{"columns":[{"name":"country","visible":true,"width":"*","sort":{"priority":0,"direction":"desc"},"filters":[{}],"pinned":""},{"name":"designation","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"points","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"price","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"variety","visible":true,"width":"*","sort":{"priority":1,"direction":"desc"},"filters":[{}],"pinned":""},{"name":"winery","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""}],"scrollFocus":{},"selection":[],"grouping":{"grouping":[],"aggregations":[],"rowExpandedStates":{}},"treeView":{},"pagination":{"paginationCurrentPage":1,"paginationPageSize":250}},"tableColumnTypeState":{"names":{"country":"string","designation":"string","points":"string","price":"string","variety":"string","winery":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"stackedAreaChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"commonSetting":{},"keys":[{"name":"country","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"designation","index":1,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550514473242_-1543867179","id":"20190218-102753_629754300","dateCreated":"2019-02-18T10:27:53-0800","dateStarted":"2019-05-25T12:13:28-0700","dateFinished":"2019-05-25T12:13:28-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11540"},{"text":"/* Exploring the Data */","user":"anonymous","dateUpdated":"2019-05-25T12:13:28-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550589843749_-2137379170","id":"20190219-072403_578068100","dateCreated":"2019-02-19T07:24:03-0800","dateStarted":"2019-05-25T12:13:28-0700","dateFinished":"2019-05-25T12:13:29-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11541"},{"text":"import org.apache.spark.sql._\n\ndef missingValues(df: DataFrame) = {\n    df.schema.map { r => (r.name, df.where(col(r.name).isNull).count) }.toDF(\"name\", \"missing\")\n}","user":"anonymous","dateUpdated":"2019-05-25T12:13:29-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550518749852_-2024339985","id":"20190218-113909_1446466485","dateCreated":"2019-02-18T11:39:09-0800","dateStarted":"2019-05-25T12:13:29-0700","dateFinished":"2019-05-25T12:13:31-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11542"},{"text":"missingValues(wineReviewsDf).show","user":"anonymous","dateUpdated":"2019-05-25T12:13:31-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550448827732_1955247256","id":"20190217-161347_242927122","dateCreated":"2019-02-17T16:13:47-0800","dateStarted":"2019-05-25T12:13:31-0700","dateFinished":"2019-05-25T12:13:33-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11543"},{"text":"def distinctValues(df: DataFrame) = {\n    df.schema.map { r => (r.name, df.where(col(r.name).isNotNull).distinct.count) }.toDF(\"name\", \"distinct\")\n}","user":"anonymous","dateUpdated":"2019-05-25T12:13:33-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550519814039_-105624215","id":"20190218-115654_51861996","dateCreated":"2019-02-18T11:56:54-0800","dateStarted":"2019-05-25T12:13:34-0700","dateFinished":"2019-05-25T12:13:34-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11544"},{"text":"","user":"anonymous","dateUpdated":"2019-05-25T12:13:34-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550721854404_1949405037","id":"20190220-200414_263231684","dateCreated":"2019-02-20T20:04:14-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11545"},{"text":"distinctValues(wineReviewsDf).show(50, false)","user":"anonymous","dateUpdated":"2019-05-25T12:13:35-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550448645324_-1801809832","id":"20190217-161045_235884019","dateCreated":"2019-02-17T16:10:45-0800","dateStarted":"2019-05-25T12:13:35-0700","dateFinished":"2019-05-25T12:13:58-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11546"},{"text":"def columnStats(df: DataFrame) = {\n    df.schema.map { r =>\n     val colStats = df.select(col(r.name)).where(col(r.name).isNotNull).describe()\n     /*colStats.printSchema*/\n     colStats.show()\n    }\n}","user":"anonymous","dateUpdated":"2019-05-25T12:13:58-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550513594484_189751446","id":"20190218-101314_1830514764","dateCreated":"2019-02-18T10:13:14-0800","dateStarted":"2019-05-25T12:13:58-0700","dateFinished":"2019-05-25T12:13:58-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11547"},{"text":"columnStats(wineReviewsDf)","user":"anonymous","dateUpdated":"2019-05-25T12:13:58-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":344.006,"optionOpen":false}}},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550518868047_1578176532","id":"20190218-114108_1861020301","dateCreated":"2019-02-18T11:41:08-0800","dateStarted":"2019-05-25T12:13:59-0700","dateFinished":"2019-05-25T12:14:06-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11548"},{"text":"def calculateColumnAggregates(df: DataFrame): Unit = {\n  df.schema.map { r =>\n    val name = r.name\n    val colData = df.select(col(name)).where(col(name).isNotNull)\n    colData.agg(\n        lit(name) as \"colname\",\n        count(name) as \"count\",\n        min(name) as \"min\",\n        avg(name) as \"avg\",\n        stddev_pop(name) as \"sd_pop\",\n        stddev_samp(name) as \"sd_sample\",\n        max(name) as \"max\"\n    ).show()\n  }\n}","user":"anonymous","dateUpdated":"2019-05-25T12:14:06-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550518785157_762115461","id":"20190218-113945_34867748","dateCreated":"2019-02-18T11:39:45-0800","dateStarted":"2019-05-25T12:14:06-0700","dateFinished":"2019-05-25T12:14:07-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11549"},{"text":"/* Process of Filling Missing Data (imputation) */\n\n/* Mine Prices by Country and by Country/Variety aggs */\n\nval priceStatsByCountry = wineReviewsDf\n  .where(col(\"country\").isNotNull)\n  .groupBy(\"country\")\n  .agg(\n      count(\"*\") as \"total\",\n      min(\"price\") as \"min_price\",\n      avg(\"price\") as \"avg_price\",\n      max(\"price\") as \"max_price\"\n  )\n\npriceStatsByCountry.createOrReplaceTempView(\"pricebycountry\")\n\n/* Price Stats by country / variety */\nval priceStatsByCountryAndVariety = wineReviewsDf\n  .where(col(\"variety\").isNotNull.and(col(\"country\").isNotNull))\n  .groupBy(\"country\", \"variety\")\n  .agg(\n      count(\"*\") as \"total\",\n      min(\"price\") as \"min_price\",\n      avg(\"price\") as \"avg_price\",\n      max(\"price\") as \"max_price\"\n  )\n\npriceStatsByCountryAndVariety.createOrReplaceTempView(\"pricebycountryvariety\")\n\n\n  ","user":"anonymous","dateUpdated":"2019-05-25T12:14:07-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550520743792_-66096883","id":"20190218-121223_928741014","dateCreated":"2019-02-18T12:12:23-0800","dateStarted":"2019-05-25T12:14:07-0700","dateFinished":"2019-05-25T12:14:07-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11550"},{"text":"%sql\nselect * from pricebycountry","user":"anonymous","dateUpdated":"2019-07-23T09:47:48-0700","config":{"colWidth":6,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":true,"setting":{"table":{"tableGridState":{"columns":[{"name":"country","visible":true,"width":"*","sort":{"priority":0,"direction":"asc"},"filters":[{}],"pinned":""},{"name":"total","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"min_price","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"avg_price","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"max_price","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""}],"scrollFocus":{},"selection":[],"grouping":{"grouping":[],"aggregations":[],"rowExpandedStates":{}},"treeView":{},"pagination":{"paginationCurrentPage":1,"paginationPageSize":250}},"tableColumnTypeState":{"names":{"country":"string","total":"string","min_price":"string","avg_price":"string","max_price":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default","stacked":true},"scatterChart":{"xAxis":{"name":"country","index":0,"aggr":"sum"},"yAxis":{"name":"avg_price","index":3,"aggr":"sum"},"size":{"name":"total","index":1,"aggr":"sum"}}},"keys":[{"name":"country","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"min_price","index":2,"aggr":"sum"},{"name":"avg_price","index":3,"aggr":"sum"}],"commonSetting":{}},"helium":{}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550540180099_-1981613903","id":"20190218-173620_2124470277","dateCreated":"2019-02-18T17:36:20-0800","dateStarted":"2019-05-25T12:14:08-0700","dateFinished":"2019-05-25T12:14:08-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11551"},{"text":"%sql\nselect * from pricebycountry","user":"anonymous","dateUpdated":"2019-07-23T09:47:48-0700","config":{"colWidth":6,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"country":"string","variety":"string","total":"string","min_price":"string","avg_price":"string","max_price":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"scatterChart":{"xAxis":{"name":"avg_price","index":3,"aggr":"sum"},"yAxis":{"name":"country","index":0,"aggr":"sum"}},"lineChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"pieChart":{},"stackedAreaChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default","stacked":true}},"keys":[{"name":"country","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"avg_price","index":3,"aggr":"sum"},{"name":"max_price","index":4,"aggr":"sum"}],"commonSetting":{}},"helium":{}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550540584330_-1593577239","id":"20190218-174304_1776569489","dateCreated":"2019-02-18T17:43:04-0800","dateStarted":"2019-05-25T12:14:08-0700","dateFinished":"2019-05-25T12:14:09-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11552"},{"text":"import spark.implicits._\nval fixedReviews = wineReviewsDf\n  .withColumn(\"num_points\", 'points.cast(\"Double\"))\n  .drop(\"points\")\n  .withColumnRenamed(\"num_points\", \"points\")\n  .withColumn(\"num_price\", 'price.cast(\"Double\"))\n  .drop(\"price\")\n  .withColumnRenamed(\"num_price\", \"price\")","user":"anonymous","dateUpdated":"2019-05-25T12:14:09-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550520024207_-1716777000","id":"20190218-120024_2018879072","dateCreated":"2019-02-18T12:00:24-0800","dateStarted":"2019-05-25T12:14:09-0700","dateFinished":"2019-05-25T12:14:10-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11553"},{"text":"fixedReviews\n  .where(col(\"price\").isNull.and(col(\"country\").isNotNull))\n  .groupBy(\"country\")\n  .agg(count(\"*\") as \"total\")\n  .sort(desc(\"total\"))\n  .show(70)","user":"anonymous","dateUpdated":"2019-05-25T12:14:10-0700","config":{"colWidth":6,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":438.153,"optionOpen":false}}},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550588423344_893098066","id":"20190219-070023_731573586","dateCreated":"2019-02-19T07:00:23-0800","dateStarted":"2019-05-25T12:14:10-0700","dateFinished":"2019-05-25T12:14:11-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11554"},{"text":"fixedReviews\n  .where(col(\"price\").isNotNull.and(col(\"country\").isNotNull))\n  .groupBy(\"country\")\n  .agg(count(\"*\") as \"total\")\n  .sort(desc(\"total\"))\n  .show(70)","user":"anonymous","dateUpdated":"2019-05-25T12:14:11-0700","config":{"colWidth":6,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":435.923,"optionOpen":false}}},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550590178855_-294203091","id":"20190219-072938_362376241","dateCreated":"2019-02-19T07:29:38-0800","dateStarted":"2019-05-25T12:14:11-0700","dateFinished":"2019-05-25T12:14:12-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11555"},{"text":"calculateColumnAggregates(fixedReviews)","user":"anonymous","dateUpdated":"2019-05-25T12:14:12-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550518658220_-2076335749","id":"20190218-113738_1506269894","dateCreated":"2019-02-18T11:37:38-0800","dateStarted":"2019-05-25T12:14:12-0700","dateFinished":"2019-05-25T12:14:19-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11556"},{"text":"/* Percentiles */\nfixedReviews.createOrReplaceTempView(\"winereviews\")","user":"anonymous","dateUpdated":"2019-05-25T12:14:19-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550541475411_-801810408","id":"20190218-175755_1481131532","dateCreated":"2019-02-18T17:57:55-0800","dateStarted":"2019-05-25T12:14:19-0700","dateFinished":"2019-05-25T12:14:19-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11557"},{"text":"%sql\nselect country,title,variety,winery,points,price from winereviews where price < 40 AND points > 95","user":"anonymous","dateUpdated":"2019-05-25T12:14:19-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{"columns":[{"name":"country","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"description","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"designation","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"province","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"region_1","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"region_2","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"taster_name","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"taster_twitter_handle","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"title","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"variety","visible":true,"width":"*","sort":{"priority":0,"direction":"desc"},"filters":[{}],"pinned":""},{"name":"winery","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"points","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"price","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""}],"scrollFocus":{},"selection":[],"grouping":{"grouping":[],"aggregations":[],"rowExpandedStates":{}},"treeView":{},"pagination":{"paginationCurrentPage":1,"paginationPageSize":250}},"tableColumnTypeState":{"names":{"country":"string","title":"string","variety":"string","winery":"string","points":"string","price":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550790153917_1790030488","id":"20190221-150233_62802091","dateCreated":"2019-02-21T15:02:33-0800","dateStarted":"2019-05-25T12:14:19-0700","dateFinished":"2019-05-25T12:14:20-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11558"},{"text":"%sql\nselect country, count(*) as total, min(price) as min, percentile_approx(price, 0.25) as p25, percentile_approx(price, 0.5) as p50, percentile_approx(price, 0.75) as p75, percentile_approx(price, 0.90) as p90, percentile_approx(price, 0.99) as p99, max(price) as max, avg(price) as avg, stddev_pop(price) as stddev\nfrom winereviews group by country","user":"anonymous","dateUpdated":"2019-07-23T09:47:49-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":true,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"country":"string","total":"string","min":"string","p25":"string","p50":"string","p75":"string","p90":"string","p99":"string","max":"string","avg":"string","stddev":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default","stacked":true}},"commonSetting":{},"keys":[{"name":"country","index":0,"aggr":"sum"},{"name":"p25","index":3,"aggr":"sum"}],"groups":[],"values":[{"name":"min","index":2,"aggr":"sum"},{"name":"p25","index":3,"aggr":"sum"},{"name":"p50","index":4,"aggr":"sum"},{"name":"avg","index":9,"aggr":"sum"},{"name":"p75","index":5,"aggr":"sum"},{"name":"p99","index":7,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550541582550_711203128","id":"20190218-175942_964820216","dateCreated":"2019-02-18T17:59:42-0800","dateStarted":"2019-05-25T12:14:20-0700","dateFinished":"2019-05-25T12:14:22-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11559"},{"text":"/* extend spark sql */\nimport org.apache.spark.sql.functions.udf\n\ndef zScore(value: Double, mean: Double, sd: Double): Double = {\n    (value-mean)/sd\n}\n\nval rowZScore : (Double, Double, Double) => Double = zScore(_,_,_)\n\nval zScoreFun = udf(rowZScore)\n\n/*\n// alternative to register for the sql world\nspark.udf.register(\"zScore\", (value: Double, mean: Double, sd: Double) => zScore(value, mean, sd))\n*/\n\nval zscoredata = Seq(2.0, 2.0, 2.0, 50.0, 50.0, 50.0, 75.0, 75.0, 120.0, 120.0, 250.0, 3000.0).toDF(\"score\")\n\nzscoredata.createOrReplaceTempView(\"simple\")\n\nspark.sql(\"select avg(score) as mean, stddev_pop(score) as sd from simple\").show\n\n/*\nmean: 316.33\nsd: 811.85\n*/\n\nzscoredata\n  .withColumn(\"zscore\", zScoreFun(col(\"score\"), lit(316.33), lit(811.85)))\n  .withColumn(\"rand\", (rand()*100).cast(\"String\"))\n  .show","user":"anonymous","dateUpdated":"2019-05-25T12:14:22-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550682998591_-1698309993","id":"20190220-091638_118407347","dateCreated":"2019-02-20T09:16:38-0800","dateStarted":"2019-05-25T12:14:22-0700","dateFinished":"2019-05-25T12:14:23-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11560"},{"text":"/* Price Imputation */\n\nval fullPriceData = spark.sql(\"select country, count(*) as total, min(price) as min, percentile_approx(price, 0.25) as p25, percentile_approx(price, 0.5) as p50, percentile_approx(price, 0.75) as p75, percentile_approx(price, 0.90) as p90, percentile_approx(price, 0.99) as p99, max(price) as max, avg(price) as avg, stddev_pop(price) as sd_pop, stddev_samp(price) as sd_sample from winereviews group by country\")\n\nval missingPriceRows = fixedReviews\n  .where(col(\"price\").isNull.and(col(\"country\").isNotNull)).groupBy(\"country\")\n  .agg(count(\"*\") as \"missing\")\n\nval joinedWithOtherPrices = missingPriceRows\n  .join(fullPriceData, \"country\")\n  .withColumn(\"miss_perc\", ((col(\"missing\")/col(\"total\"))*100).cast(\"Float\"))\n  .withColumn(\"iqr\", (col(\"p75\")-col(\"p25\")).cast(\"Float\"))\n  .withColumn(\"min_max_dist\", (col(\"max\")-col(\"min\")).cast(\"Integer\"))\n  .withColumn(\"median_mean_dist\", (col(\"p50\")-col(\"avg\")).cast(\"Float\")).where(col(\"total\") > 1)\n\njoinedWithOtherPrices.createOrReplaceTempView(\"priceimputation\")","user":"anonymous","dateUpdated":"2019-05-25T12:14:23-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550590505134_-234216159","id":"20190219-073505_1435002574","dateCreated":"2019-02-19T07:35:05-0800","dateStarted":"2019-05-25T12:14:23-0700","dateFinished":"2019-05-25T12:14:23-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11561"},{"text":"joinedWithOtherPrices.printSchema","user":"anonymous","dateUpdated":"2019-05-25T12:14:23-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550594674793_-550675933","id":"20190219-084434_474949361","dateCreated":"2019-02-19T08:44:34-0800","dateStarted":"2019-05-25T12:14:23-0700","dateFinished":"2019-05-25T12:14:24-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11562"},{"text":"%sql\nselect country,miss_perc,avg,p50,median_mean_dist,iqr,p99,sd_sample from priceimputation","user":"anonymous","dateUpdated":"2019-07-23T09:47:50-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":294.006,"optionOpen":false,"setting":{"table":{"tableGridState":{"columns":[{"name":"country","visible":true,"width":150,"sort":{},"filters":[{}],"pinned":""},{"name":"missing","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"total","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"min","visible":false,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"p25","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"p50","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"p75","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"p90","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"p99","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"max","visible":true,"width":150,"sort":{},"filters":[{}],"pinned":""},{"name":"avg","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"stddev","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"miss_perc","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"min_max_dist","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"mean_p50_dist","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""}],"scrollFocus":{},"selection":[],"grouping":{"grouping":[],"aggregations":[],"rowExpandedStates":{}},"treeView":{},"pagination":{"paginationCurrentPage":1,"paginationPageSize":250}},"tableColumnTypeState":{"names":{"country":"string","avg":"string","p50":"string","mean_p50_dist":"string","iqr":"string","p99":"string","sd_sample":"string","miss_perc":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"120"},"xLabelStatus":"default","stacked":true},"stackedAreaChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"commonSetting":{},"keys":[{"name":"country","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"avg","index":2,"aggr":"sum"},{"name":"p50","index":3,"aggr":"sum"},{"name":"iqr","index":5,"aggr":"sum"},{"name":"p99","index":6,"aggr":"sum"},{"name":"sd_sample","index":7,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550593285206_-1442847906","id":"20190219-082125_705404637","dateCreated":"2019-02-19T08:21:25-0800","dateStarted":"2019-05-25T12:14:24-0700","dateFinished":"2019-05-25T12:14:25-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11563"},{"text":"/* Use imputation data to fill in unknown prices */\nval missingPriceDf = fixedReviews.where(col(\"price\").isNull.and(col(\"country\").isNotNull))\nval normalDf = fixedReviews.where(col(\"price\").isNotNull)\n\nval imputedPrice = missingPriceDf\n  .join(joinedWithOtherPrices, \"country\")\n  .withColumn(\"price\", when(col(\"avg\")>col(\"p50\"), col(\"p50\")).otherwise(col(\"avg\")))\n  .drop(\"total\",\"min\",\"p25\",\"p50\",\"p75\",\"p90\",\"p99\",\"max\",\"avg\",\"sd_pop\",\"sd_sample\"\n  ,\"miss_perc\",\"iqR\",\"min_max_dist\",\"median_mean_dist\", \"missing\")\n/* both schemas must match for union */\nval filledPriceDf = normalDf.union(imputedPrice)\nfilledPriceDf.cache()\nfilledPriceDf.createOrReplaceTempView(\"winereviews\")","user":"anonymous","dateUpdated":"2019-05-25T12:14:25-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","tableHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550595279357_-898296761","id":"20190219-085439_1504895806","dateCreated":"2019-02-19T08:54:39-0800","dateStarted":"2019-05-25T12:14:26-0700","dateFinished":"2019-05-25T12:14:26-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11564"},{"text":"filledPriceDf\n  .where(col(\"price\").isNull)\n  .agg(count(\"*\") as \"total\").show","user":"anonymous","dateUpdated":"2019-05-25T12:14:26-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550601894632_-1856818419","id":"20190219-104454_1615373073","dateCreated":"2019-02-19T10:44:54-0800","dateStarted":"2019-05-25T12:14:27-0700","dateFinished":"2019-05-25T12:14:30-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11565"},{"text":"/* Other Visualizations (Max Price by Country and Reviews by Varietal) */","user":"anonymous","dateUpdated":"2019-05-25T12:14:30-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550595090702_-1429714107","id":"20190219-085130_2063977367","dateCreated":"2019-02-19T08:51:30-0800","dateStarted":"2019-05-25T12:14:30-0700","dateFinished":"2019-05-25T12:14:30-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11566"},{"text":"%sql\nselect max(price) as max_price, country from winereviews\nwhere country IS NOT NULL\ngroup by country","user":"anonymous","dateUpdated":"2019-07-23T09:47:50-0700","config":{"colWidth":6,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":215.668,"optionOpen":false,"setting":{"table":{"tableGridState":{"columns":[{"name":"avg_price","visible":true,"width":"*","sort":{"priority":0,"direction":"desc"},"filters":[{}],"pinned":""},{"name":"country","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""}],"scrollFocus":{},"selection":[],"grouping":{"grouping":[],"aggregations":[],"rowExpandedStates":{}},"treeView":{},"pagination":{"paginationCurrentPage":1,"paginationPageSize":250}},"tableColumnTypeState":{"names":{"avg_price":"string","country":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default","stacked":false},"stackedAreaChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"pieChart":{},"lineChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"commonSetting":{},"keys":[{"name":"country","index":1,"aggr":"sum"}],"groups":[],"values":[{"name":"max_price","index":0,"aggr":"sum"}]},"helium":{}},"1":{"graph":{"mode":"table","height":85.9659,"optionOpen":false}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550511501625_-121607522","id":"20190218-093821_1712886793","dateCreated":"2019-02-18T09:38:21-0800","dateStarted":"2019-05-25T12:14:30-0700","dateFinished":"2019-05-25T12:14:31-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11567"},{"text":"%sql\nselect count(variety) as reviews, variety from winereviews\nwhere variety IS NOT NULL\ngroup by variety\norder by reviews desc","user":"anonymous","dateUpdated":"2019-05-25T12:20:54-0700","config":{"colWidth":3,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"scatterChart","height":203.977,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"reviews":"string","variety":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"pieChart":{},"lineChart":{"xLabelStatus":"default","rotate":{"degree":"-45"}},"scatterChart":{"xAxis":{"name":"variety","index":1,"aggr":"sum"},"yAxis":{"name":"reviews","index":0,"aggr":"sum"},"size":{"name":"reviews","index":0,"aggr":"sum"}},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"stackedAreaChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"keys":[{"name":"variety","index":1,"aggr":"sum"}],"groups":[],"values":[{"name":"reviews","index":0,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550511986682_154429541","id":"20190218-094626_1783944215","dateCreated":"2019-02-18T09:46:26-0800","dateStarted":"2019-05-25T12:14:31-0700","dateFinished":"2019-05-25T12:14:32-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11568"},{"text":"/* Unsupervised Learning */\nimport org.apache.spark.ml.fpm.FPGrowth\nimport org.apache.spark.ml.feature.StopWordsRemover\nimport org.apache.spark.ml.Pipeline\nimport org.apache.spark.ml.feature.StringIndexer\nimport org.apache.spark.ml.feature.OneHotEncoder\nimport org.apache.spark.ml.feature.VectorAssembler\nimport org.apache.spark.ml.clustering.KMeans\n","user":"anonymous","dateUpdated":"2019-05-25T12:14:32-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550605420172_1073706129","id":"20190219-114340_762102300","dateCreated":"2019-02-19T11:43:40-0800","dateStarted":"2019-05-25T12:14:32-0700","dateFinished":"2019-05-25T12:14:32-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11569"},{"text":"/* How to use KMeans Model */\n\n/* which countries can be filled in by varietal */\n/* note: indexers can't handle null values */\nval normalizedWine = filledPriceDf.where(col(\"country\").isNotNull.and(col(\"variety\").isNotNull))\nnormalizedWine.cache()\n\nval indexerCountry = new StringIndexer()\n  .setInputCol(\"country\")\n  .setOutputCol(\"country_index\")\n\nval encoderCountry = new OneHotEncoder()\n  .setInputCol(\"country_index\")\n  .setOutputCol(\"country_encoded\")\n\nval indexerVariety = new StringIndexer()\n  .setInputCol(\"variety\")\n  .setOutputCol(\"variety_index\")\n\nval encoderVariety = new OneHotEncoder()\n  .setInputCol(\"variety_index\")\n  .setOutputCol(\"variety_encoded\")\n\nval wineVectorAssembler = new VectorAssembler()\n  .setInputCols(Array(\"country_encoded\", \"variety_encoded\", \"price\", \"points\"))\n  .setOutputCol(\"features\")\n\nval transformerPipeline = new Pipeline()\n  .setStages(Array(\n      indexerCountry,\n      encoderCountry,\n      indexerVariety,\n      encoderVariety,\n      wineVectorAssembler))\n\nval fittedPipeline = transformerPipeline.fit(normalizedWine)\nval Array(trainingData, testData) = normalizedWine.randomSplit(Array(0.7, 0.3), seed=10L)\n\nval transformedTraining = fittedPipeline.transform(trainingData)\ntransformedTraining.cache()\n\nval kmeans = new KMeans()\n  .setK(5)\n  .setSeed(1L)\n\nval kmModel = kmeans.fit(transformedTraining)\nkmModel.computeCost(transformedTraining)\n\nval transformedTest = fittedPipeline.transform(testData)\ntransformedTest.cache()\n\n// within set sum of squares errors\nval cost = kmModel.computeCost(transformedTest)\nprintln(s\"WSSE=$cost\")\n","user":"anonymous","dateUpdated":"2019-05-25T12:14:32-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550520774290_-1701881406","id":"20190218-121254_432383687","dateCreated":"2019-02-18T12:12:54-0800","dateStarted":"2019-05-25T12:14:33-0700","dateFinished":"2019-05-25T12:14:55-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11570"},{"text":"kmModel.transform(transformedTest).createOrReplaceTempView(\"kmeans\")","user":"anonymous","dateUpdated":"2019-05-25T12:14:55-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550616743664_-1803327684","id":"20190219-145223_127560081","dateCreated":"2019-02-19T14:52:23-0800","dateStarted":"2019-05-25T12:14:55-0700","dateFinished":"2019-05-25T12:14:56-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11571"},{"text":"kmModel.transform(transformedTraining).createOrReplaceTempView(\"kmeanstrain\")","user":"anonymous","dateUpdated":"2019-05-25T12:14:56-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550617543976_-1671517143","id":"20190219-150543_424924585","dateCreated":"2019-02-19T15:05:43-0800","dateStarted":"2019-05-25T12:14:56-0700","dateFinished":"2019-05-25T12:14:56-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11572"},{"text":"%sql\nselect * from kmeanstrain","user":"anonymous","dateUpdated":"2019-07-22T17:18:07-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"scatterChart","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"country":"string","description":"string","designation":"string","province":"string","region_1":"string","region_2":"string","taster_name":"string","taster_twitter_handle":"string","title":"string","variety":"string","winery":"string","points":"string","price":"string","country_index":"string","country_encoded":"string","variety_index":"string","variety_encoded":"string","features":"string","prediction":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"scatterChart":{"group":{"name":"prediction","index":18,"aggr":"sum"},"yAxis":{"name":"points","index":11,"aggr":"sum"},"xAxis":{"name":"price","index":12,"aggr":"sum"}},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default","stacked":false}},"commonSetting":{},"keys":[{"name":"points","index":11,"aggr":"sum"},{"name":"price","index":12,"aggr":"sum"}],"groups":[{"name":"prediction","index":18,"aggr":"sum"}],"values":[{"name":"prediction","index":18,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550617592303_-795394036","id":"20190219-150632_1080120323","dateCreated":"2019-02-19T15:06:32-0800","dateStarted":"2019-05-25T12:14:56-0700","dateFinished":"2019-05-25T12:14:57-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11573"},{"text":"%sql\nselect * from kmeans","user":"anonymous","dateUpdated":"2019-07-23T09:39:44-0700","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"scatterChart","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"country":"string","description":"string","designation":"string","province":"string","region_1":"string","region_2":"string","taster_name":"string","taster_twitter_handle":"string","title":"string","variety":"string","winery":"string","points":"string","price":"string","country_index":"string","country_encoded":"string","variety_index":"string","variety_encoded":"string","features":"string","prediction":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"scatterChart":{"yAxis":{"name":"points","index":11,"aggr":"sum"},"group":{"name":"prediction","index":18,"aggr":"sum"},"xAxis":{"name":"country","index":0,"aggr":"sum"}},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default","stacked":true}},"keys":[{"name":"variety","index":9,"aggr":"sum"}],"groups":[{"name":"prediction","index":18,"aggr":"sum"}],"values":[{"name":"price","index":12,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550616783141_-1110932907","id":"20190219-145303_640540690","dateCreated":"2019-02-19T14:53:03-0800","dateStarted":"2019-05-25T12:14:58-0700","dateFinished":"2019-05-25T12:14:59-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11574"},{"text":"%sql\nselect * from winereviews where points > 90","user":"anonymous","dateUpdated":"2019-05-25T12:21:16-0700","config":{"colWidth":4,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"country":"string","description":"string","designation":"string","province":"string","region_1":"string","region_2":"string","taster_name":"string","taster_twitter_handle":"string","title":"string","variety":"string","winery":"string","points":"string","price":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550788316839_1309344597","id":"20190221-143156_928141818","dateCreated":"2019-02-21T14:31:56-0800","dateStarted":"2019-05-25T12:15:01-0700","dateFinished":"2019-05-25T12:15:01-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11575"},{"text":"/* How to use FPGrowth Model */\ndef tastingNotes(df: DataFrame, minSupport: Double = 0.05, minConfidence: Double = 0.6, freq: Int = 400): String = {\n  // can mess around easily with different selection criteria by changing the minSupport and minConfidence coefficents\n  val fpg = new FPGrowth()\n    .setItemsCol(\"items\")\n    .setMinSupport(minSupport)\n    .setMinConfidence(minConfidence)\n  \n  val remover = new StopWordsRemover()\n    .setInputCol(\"items\")\n    .setOutputCol(\"filteredItems\")\n  \n  // Cleaning up the Wine Descriptions\n  val descriptions = df\n    .select(col(\"description\")).where(col(\"description\").isNotNull)\n    .map { case Row(s:String) =>\n      s.replace(\",\",\"\").replace(\".\",\"\").replace(\"wine\", \"\").split(\" \").toSet.toSeq\n    }\n    .toDF(\"items\")\n\t\n  // remove StopWords\n  val filteredDescriptions = remover.transform(descriptions)\n  val stopWordsFiltered = filteredDescriptions.select(\"filteredItems\").toDF(\"items\")\n  val model = fpg.fit(stopWordsFiltered)\n  val freqItems = model.freqItemsets.sort(desc(\"freq\"))\n  val notes = freqItems.select(\"items\").where(col(\"freq\")>freq)\n  val topWords = notes.flatMap { case Row(notes: Seq[String]) => notes }.groupBy(\"value\").count().sort(desc(\"count\"))\n  val tastingNotes = topWords.select(\"value\").collect().map { case Row(s: String) => s }.toSeq.mkString(\",\")\n  tastingNotes\n}\n\nval redBlends = spark.sql(\"select * from winereviews where `variety` == 'Red Blend'\")\nredBlends.cache\nredBlends.explain(true)\nval redBlendTastingNotes = tastingNotes(redBlends)\n","user":"anonymous","dateUpdated":"2019-05-25T12:21:21-0700","config":{"colWidth":6,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","tableHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550520789987_1052035560","id":"20190218-121309_1889092465","dateCreated":"2019-02-18T12:13:09-0800","dateStarted":"2019-05-25T12:15:02-0700","dateFinished":"2019-05-25T12:15:18-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11576"},{"text":"redBlendTastingNotes","user":"anonymous","dateUpdated":"2019-05-25T12:21:06-0700","config":{"colWidth":6,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550637290685_1216171258","id":"20190219-203450_66291224","dateCreated":"2019-02-19T20:34:50-0800","dateStarted":"2019-05-25T12:15:19-0700","dateFinished":"2019-05-25T12:15:19-0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:11577"}],"name":"ODSC 2019 East Warm Up","id":"2E4BZ7TRW","noteParams":{},"noteForms":{},"angularObjects":{"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}